# üéØ Jornada de Meta de Peso - Plano de Implementa√ß√£o

> **Objetivo**: Transformar o NutriSmart no melhor app de acompanhamento de emagrecimento/ganho de peso do mercado, superando MyFitnessPal.

---

## üìä An√°lise Competitiva

| Feature | MyFitnessPal | NutriSmart (Atual) | NutriSmart (Proposto) |
|---------|--------------|--------------------|-----------------------|
| Meta de peso | ‚úÖ B√°sico | ‚ùå N√£o tem | ‚úÖ Com timeline e milestones |
| Ajuste din√¢mico de calorias | ‚ö†Ô∏è Manual | ‚ùå N√£o tem | ‚úÖ Autom√°tico por kg perdido |
| Proje√ß√£o de chegada | ‚ö†Ô∏è Est√°tico | ‚ùå N√£o tem | ‚úÖ IA atualiza semanalmente |
| Modo Cl√≠nico (GLP-1) | ‚ùå N√£o tem | ‚úÖ Tem | ‚úÖ Integrado com metas |
| Celebra√ß√£o de marcos | ‚ö†Ô∏è B√°sico | ‚ö†Ô∏è Badges | ‚úÖ Milestones personalizados |

---

## üèóÔ∏è Arquitetura Proposta

### Novo Modelo de Dados

```typescript
// types.ts - Novas interfaces
interface WeightGoal {
  startWeight: number;      // Peso inicial ao criar meta
  targetWeight: number;     // Peso desejado
  startDate: string;        // Data de in√≠cio
  targetDate?: string;      // Data alvo (opcional)
  estimatedDate?: string;   // Proje√ß√£o calculada pela IA
  weeklyGoal: number;       // Meta semanal (ex: -0.5kg ou +0.3kg)
  milestones: WeightMilestone[];
  status: 'active' | 'achieved' | 'paused';
}

interface WeightMilestone {
  id: string;
  targetWeight: number;     // Ex: 85kg (halfway)
  title: string;            // "Metade do caminho!"
  achievedAt?: string;
  xpReward: number;
}

interface WeightEntry {
  date: string;
  weight: number;
  note?: string;            // "Me senti mais leve"
  source?: 'manual' | 'smart_scale' | 'wearable';
}

interface User {
  // ... campos existentes
  weightGoal?: WeightGoal;
  weightHistory?: WeightEntry[];
}
```

---

## üìã Fases de Implementa√ß√£o

### FASE 1: Funda√ß√£o (Tipos + Onboarding)
**Prioridade: Alta | Estimativa: 3-4 horas**

#### [MODIFY] [types.ts](file:///d:/SaaS/NutriSmart/nutrismart/types.ts)
- Adicionar interfaces `WeightGoal`, `WeightMilestone`, [WeightEntry](file:///d:/SaaS/NutriSmart/nutrismart/pages/Progress.tsx#9-13)
- Atualizar interface [User](file:///d:/SaaS/NutriSmart/nutrismart/types.ts#1-20) com `weightGoal` e `weightHistory`

#### [MODIFY] [Onboarding.tsx](file:///d:/SaaS/NutriSmart/nutrismart/pages/Onboarding.tsx)
- Adicionar step para definir meta de peso (se goal ‚â† manter_peso)
- Input para peso desejado com visualiza√ß√£o do delta
- Slider para velocidade: Conservador/Moderado/Agressivo
- Proje√ß√£o de data estimada baseada na velocidade

#### [MODIFY] [nutritionCalculator.ts](file:///d:/SaaS/NutriSmart/nutrismart/services/nutritionCalculator.ts)
- Calcular meta semanal baseada na velocidade
- Fun√ß√£o `estimateTargetDate(currentWeight, targetWeight, weeklyGoal)`

---

### FASE 2: Acompanhamento de Progresso
**Prioridade: Alta | Estimativa: 4-5 horas**

#### [MODIFY] [Progress.tsx](file:///d:/SaaS/NutriSmart/nutrismart/pages/Progress.tsx)
- Se√ß√£o hero: "Voc√™ est√° em X% do caminho para Ykg"
- Gr√°fico de peso com linha de tend√™ncia e linha de meta
- Proje√ß√£o visual de quando alcan√ßar√° a meta
- Mini-celebra√ß√µes ao atingir milestones

#### [NEW] [WeightGoalCard.tsx](file:///d:/SaaS/NutriSmart/nutrismart/components/WeightGoalCard.tsx)
- Card reutiliz√°vel para Dashboard e Progress
- Mostra: peso atual vs meta, progresso %, dias restantes
- √çcone de tend√™ncia (subindo/descendo)

#### [MODIFY] [Dashboard.tsx](file:///d:/SaaS/NutriSmart/nutrismart/pages/Dashboard.tsx)
- Integrar `WeightGoalCard` no topo
- Mostrar "X kg para sua meta" de forma motivacional

---

### FASE 3: Ajuste Din√¢mico de Calorias
**Prioridade: Alta | Estimativa: 2-3 horas**

#### [MODIFY] [nutritionCalculator.ts](file:///d:/SaaS/NutriSmart/nutrismart/services/nutritionCalculator.ts)
- Recalcular metas quando peso muda significativamente (>1kg)
- Usar peso atual da √∫ltima pesagem (n√£o o inicial)
- Manter hist√≥rico de ajustes

#### [NEW] [CalorieAdjustmentService.ts](file:///d:/SaaS/NutriSmart/nutrismart/services/CalorieAdjustmentService.ts)
- L√≥gica para sugerir rec√°lculo
- Detectar plat√¥s (4+ semanas sem mudan√ßa)
- Alertar sobre velocidade de perda (>1kg/semana = warning)

---

### FASE 4: Intelig√™ncia Artificial
**Prioridade: M√©dia | Estimativa: 3-4 horas**

#### [MODIFY] [api/gemini.ts](file:///d:/SaaS/NutriSmart/nutrismart/api/gemini.ts)
Nova action: `analyze_weight_progress`
- Input: hist√≥rico de peso, meta, meals, exerc√≠cios
- Output: insights, ajustes sugeridos, motiva√ß√£o

#### [NEW] [WeightInsightsCard.tsx](file:///d:/SaaS/NutriSmart/nutrismart/components/WeightInsightsCard.tsx)
- Mostra an√°lise semanal da IA
- Exemplos:
  - "Sua perda est√° dentro do saud√°vel ‚úì"
  - "Voc√™ tende a comer mais nos fins de semana"
  - "Aumentar prote√≠na pode acelerar resultados"

---

### FASE 5: Milestones e Gamifica√ß√£o
**Prioridade: M√©dia | Estimativa: 2-3 horas**

#### [MODIFY] [gamificationService.ts](file:///d:/SaaS/NutriSmart/nutrismart/services/gamificationService.ts)
- Novos badges de peso:
  - "Primeiro Kilo" - Perdeu/ganhou 1kg
  - "5kg Club" - 5kg de progresso
  - "Metade do Caminho" - 50% da meta
  - "Objetivo Alcan√ßado" - 100% da meta

#### [NEW] [MilestoneModal.tsx](file:///d:/SaaS/NutriSmart/nutrismart/components/MilestoneModal.tsx)
- Celebra√ß√£o animada ao atingir milestone
- Confetti + XP reward
- Op√ß√£o de compartilhar conquista

---

### FASE 6: Modo Cl√≠nico Avan√ßado
**Prioridade: Alta | Estimativa: 2 horas**

#### [MODIFY] [Profile.tsx](file:///d:/SaaS/NutriSmart/nutrismart/pages/Profile.tsx)
- Se√ß√£o "Minha Jornada" para usu√°rios cl√≠nicos
- Correla√ß√£o: peso vs dose do medicamento
- Insights espec√≠ficos para tirzepatida/semaglutida

#### [MODIFY] [MedicalReportGenerator.tsx](file:///d:/SaaS/NutriSmart/nutrismart/components/MedicalReportGenerator.tsx)
- Incluir gr√°fico de progresso de peso no relat√≥rio
- Mostrar velocidade de perda e proje√ß√£o

---

### FASE 7: Funcionalidades Avan√ßadas (Diferencial Competitivo)
**Prioridade: Alta | Estimativa: 4-5 horas**

#### 7.1 Peso Ajustado para Obesidade (IMC > 30)

**Problema**: Usu√°rios obesos recebem metas de prote√≠na insustent√°veis.

**Solu√ß√£o**: [MODIFY] [nutritionCalculator.ts](file:///d:/SaaS/NutriSmart/nutrismart/services/nutritionCalculator.ts)
```typescript
function calculateAdjustedWeight(
  currentWeight: number, 
  targetWeight: number, 
  height: number
): number {
  const bmi = currentWeight / ((height / 100) ** 2);
  
  if (bmi < 30) return currentWeight; // Usar peso atual
  
  // F√≥rmula: P_adj = P_meta + 0.25 √ó (P_atual - P_meta)
  return targetWeight + 0.25 * (currentWeight - targetWeight);
}
```

| Exemplo | Sem Ajuste | Com Ajuste |
|---------|------------|------------|
| Usu√°rio 130kg (meta 80kg) | 260g prote√≠na | **185g** ‚úÖ |

---

#### 7.2 Hidrata√ß√£o GLP-1 (+500ml)

**Problema**: Usu√°rios de tirzepatida desidratam facilmente.

**Solu√ß√£o**: [MODIFY] [nutritionCalculator.ts](file:///d:/SaaS/NutriSmart/nutrismart/services/nutritionCalculator.ts)
```typescript
export function calculateWaterGoal(
  weight: number, 
  isClinicalMode: boolean = false
): { waterMl: number; clinicalAlert?: string } {
  const baseWater = Math.round(weight * 35);
  
  if (isClinicalMode) {
    return {
      waterMl: baseWater + 500, // +500ml para GLP-1
      clinicalAlert: "‚ö†Ô∏è Medicamentos GLP-1 aumentam a necessidade h√≠drica. Mantenha o consumo de eletr√≥litos."
    };
  }
  
  return { waterMl: baseWater };
}
```

---

#### 7.3 L√≥gica Anti-Plat√¥ (IA-Powered)

**Problema**: MyFitnessPal ignora plat√¥s. Usu√°rios desistem.

**Solu√ß√£o**: [NEW] [PlateauDetectionService.ts](file:///d:/SaaS/NutriSmart/nutrismart/services/PlateauDetectionService.ts)

```typescript
interface PlateauAnalysis {
  isPlateaued: boolean;
  daysSinceChange: number;
  adherenceScore: number;  // 0-100%
  suggestion: 'refeed' | 'maintenance_week' | 'adjust_macros' | 'check_logs';
  message: string;
}

function detectPlateau(
  weightHistory: WeightEntry[],
  mealLogs: Meal[],
  last14Days: boolean = true
): PlateauAnalysis {
  // Crit√©rios:
  // - Varia√ß√£o < 0.5kg em 14 dias
  // - Ades√£o >= 80%
  // - M√≠nimo 3 pesagens
}
```

**A√ß√µes por Cen√°rio**:
| Cen√°rio | Sugest√£o |
|---------|----------|
| Plat√¥ + boa ades√£o + %BF baixo | Refeed Day |
| Plat√¥ + boa ades√£o + d√©ficit agressivo | Semana de manuten√ß√£o |
| Plat√¥ + baixa ades√£o | Alertar sobre precis√£o dos logs |

---

## üé® UX/UI Proposta

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üéØ Sua Meta: 90kg ‚Üí 75kg          ‚îÇ
‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚óè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ         ‚îÇ
‚îÇ        40% conclu√≠do                ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  üìâ Atual: 84kg (-6kg)             ‚îÇ
‚îÇ  üìÖ Proje√ß√£o: 15 de Maio           ‚îÇ
‚îÇ  ‚ö° Este ritmo: -0.5kg/semana      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ‚ö†Ô∏è Considera√ß√µes de Sa√∫de

| Situa√ß√£o | A√ß√£o do Sistema |
|----------|-----------------|
| Perda > 1kg/semana | ‚ö†Ô∏è Alerta: "Cuidado com perda r√°pida" |
| Meta < IMC 18.5 | üö´ Bloqueio: "Meta abaixo do saud√°vel" |
| Plat√¥ > 4 semanas | üí° Sugest√£o: Ajustar estrat√©gia |
| Meta atingida | üéâ Transi√ß√£o para modo manuten√ß√£o |

---

## üìä M√©tricas de Sucesso

- **Engajamento**: Pesagens semanais > 80%
- **Reten√ß√£o**: Usu√°rios com meta ativa > 60% ap√≥s 30 dias
- **Convers√£o**: Modo cl√≠nico ‚Üí com meta de peso > 90%

---

## üîÑ Depend√™ncias

| Item | Impacto |
|------|---------|
| nutritionCalculator.ts refatorado | ‚úÖ Conclu√≠do |
| Modo Cl√≠nico | ‚úÖ Conclu√≠do |
| Progress.tsx com WeightEntry | ‚úÖ Existente |
| Gamification system | ‚úÖ Existente |

---

## Verifica√ß√£o

### Testes
- [ ] Fluxo de onboarding com meta de peso
- [ ] Rec√°lculo autom√°tico ao registrar peso
- [ ] Proje√ß√£o de data atualiza corretamente
- [ ] Milestones disparam ao atingir marcos
- [ ] Relat√≥rio m√©dico inclui progresso

### Valida√ß√£o
- [ ] Limites de seguran√ßa (IMC m√≠nimo)
- [ ] Alertas de perda r√°pida funcionando
- [ ] Modo manuten√ß√£o ap√≥s meta atingida
